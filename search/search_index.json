{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to Ecool Note","text":""},{"location":"#mkdoc-usage","title":"Mkdoc usage","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"#project-dependencies","title":"Project dependencies","text":"<p>For full documentation of the theme visit mkdocs-material</p>"},{"location":"#commands_1","title":"Commands","text":"<ul> <li><code>pip install --upgrade pymdown-extensions mkdocs mkdocs-material mkdocs-glightbox</code> - Install Mkdocs, the theme and plugins</li> </ul>"},{"location":"Android/Android%E5%AE%9A%E5%88%B6%E5%8C%96ART%E4%B8%8E%E9%80%86%E5%90%91/","title":"Android\u5b9a\u5236\u5316ART\u4e0e\u9006\u5411","text":""},{"location":"Android/Android%E5%AE%9A%E5%88%B6%E5%8C%96ART%E4%B8%8E%E9%80%86%E5%90%91/#artmethod","title":"ArtMethod\u7ed3\u6784","text":"<p>\u4eceAndroid 5.0\uff08Lollipop\uff09\u5f00\u59cb\uff0cART\u53d6\u4ee3\u4e86\u4e4b\u524d\u7684Dalvik\u865a\u62df\u673a\u4f5c\u4e3aAndroid\u7684\u4e3b\u8981\u8fd0\u884c\u65f6\u73af\u5883\u3002\u5f53\u5206\u6790\u5230JNI\u51fd\u6570\u65f6\uff0c\u4e00\u822c\u90fd\u4f1a\u901a\u8fc7<code>RegisterNatives</code>\u51fd\u6570\u6765\u786e\u8ba4JNI\u51fd\u6570\u7684\u5730\u5740\uff0c\u4ece\u800c\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u5206\u6790\uff1b\u66f4\u8fdb\u4e00\u6b65\uff0c\u4e5f\u5b58\u5728\u975e\u6b63\u5e38\u6d41\u7a0b\u7684JNI\u51fd\u6570\u7684\u7ed1\u5b9a\uff0c\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u6765\u8ffd\u8e2aJNI\u51fd\u6570\u7684\u6267\u884c\u6d41\u7a0b\u5462\uff0c\u6b64\u65f6\u5c31\u8981\u63d0\u5230<code>ArtMethod</code>\u7684\u7ed3\u6784\u4e86</p> <pre><code>\n</code></pre>"},{"location":"Android/Android%E5%AE%9A%E5%88%B6%E5%8C%96ART%E4%B8%8E%E9%80%86%E5%90%91/#_1","title":"\u53c2\u8003\u6587\u6863","text":"<p>ArtHook \u6211\u4e3aDexposed\u7eed\u4e00\u79d2\u2014\u2014\u8bbaART\u4e0a\u8fd0\u884c\u65f6 Method AOP\u5b9e\u73b0  ART \u5728 Android \u5b89\u5168\u653b\u9632\u4e2d\u7684\u5e94\u7528 android\u9006\u5411\u5947\u6280\u6deb\u5de7\u5341\u4e09\uff1a\u5b9a\u5236art\u5185\u6838\uff08\u4e00\uff09\uff1a\u8ddf\u8e2ajni\u51fd\u6570\u6ce8\u518c\u548c\u8c03\u7528\uff0c\u7ed5\u8fc7\u53cd\u8c03\u8bd5 android\u9006\u5411\u5947\u6280\u6deb\u5de7\u5341\u56db\uff1a\u5b9a\u5236art\u5185\u6838\uff08\u4e8c\uff09\uff1aVMP\u9006\u5411----\u4effmethod profiling\u8ddf\u8e2ajni\u51fd\u6570\u6267\u884c</p>"},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/","title":"Android\u9006\u5411\u4e2d\u7684\u5b57\u7b26\u4e32\u52a0\u5bc6\u548c\u53cd\u6df7\u6dc6","text":""},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/#_1","title":"\u5b57\u7b26\u4e32\u52a0\u5bc6\u6982\u8ff0","text":"<p>\u76ee\u524d\uff0c\u4e3b\u6d41\u7684App\u4e0a\u90fd\u6709\u4e86\u5b57\u7b26\u4e32\u7684\u52a0\u5bc6\u548c\u6df7\u6dc6\uff0c\u8fd9\u5bf9\u4e8e\u9006\u5411\u548c\u5b89\u5168\u68c0\u6d4b\u6765\u8bf4\uff0c\u65e0\u7591\u662f\u52a0\u5927\u4e86\u96be\u5ea6\uff1b\u540c\u65f6\uff0c\u5bf9\u4e8e\u6076\u610f\u5e94\u7528\u6765\u8bf4\uff0c\u4e5f\u65b9\u4fbf\u4e86\u4ed6\u4eec\u9690\u85cf\u771f\u5b9e\u7684\u610f\u56fe\u3002</p> <p>\u4ee5\u67d0\u7f51\u7ad9\u4e0a\u7684\u8457\u540d\u9879\u76ee<code>StringFog</code>\u4e3a\u4f8b\uff0c\u8fd9\u662f\u4e00\u6b3e\u81ea\u52a8\u5bf9dex/aar/jar\u6587\u4ef6\u4e2d\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u52a0\u5bc6Android\u63d2\u4ef6\u5de5\u5177\uff0c\u5176\u5de5\u4f5c\u5982\u4e0b\u6240\u793a</p> <p></p> <p><code>StringFog</code>\u5b9e\u73b0\u7684\u539f\u7406\u5b9e\u9645\u4e0a\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u5728\u5b57\u8282\u7801\u5c42\u9762\u8fdb\u884c\u66ff\u6362\uff0c\u4f46\u662f\u5374\u80fd\u7ed9\u9006\u5411\u5206\u6790\u589e\u52a0\u8f83\u5927\u7684\u65f6\u95f4\u6210\u672c\uff0c\u5e76\u4e14\uff0c\u9664\u4e86<code>StringFog</code>\uff0c\u5e02\u9762\u4e0a\u4e5f\u5b58\u5728\u5f88\u591a\u81ea\u5b9a\u4e49\u52a0\u5bc6\u5b57\u7b26\u4e32\u7684\u65b9\u6848\uff0c\u8fd9\u7c7b\u65b9\u6848\u5f80\u5f80\u548c\u6df7\u6dc6\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u5c31\u5982\u540c\u9006\u5411\u65f6\u7684\u9e21\u808b\u4e00\u822c\uff0c\u8ba9\u5b89\u5168\u7814\u7a76\u4eba\u5458\u98df\u4e4b\u65e0\u5473\uff0c\u5f03\u4e4b\u53ef\u60dc\u3002</p>"},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/#dex","title":"\u6848\u4f8b\u4e00\uff1a\u67d0dex","text":"<p>\u901a\u8fc7<code>jadx</code>\u52a0\u8f7d\u67d0dex\u6587\u4ef6\u65f6\uff0c\u4f1a\u53d1\u73b0\u6587\u4ef6\u4e2d\u5b58\u5728\u5f88\u591a\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u7684\u52a0\u5bc6\u5f88\u5f71\u54cd\u5206\u6790\u7684\u6548\u7387\uff0c\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u53bb\u9664\u5b83\u5462\uff1f\u5728\u6700\u65b0\u7248\u672c\u7684<code>jadx</code>\u4e2d\uff0c\u5f00\u53d1\u8005\u5f15\u5165\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u529f\u80fd\u2014\u2014<code>jadx-script</code>\u3002\u901a\u8fc7<code>jadx-script</code>\uff0c\u6211\u4eec\u80fd\u591f\u5728<code>jadx</code>\u4e2d\u6267\u884ckotlin script\uff0c\u800c\u76f8\u5173\u7684\u4f8b\u5b50\uff0c\u4e5f\u653e\u5728<code>jadx-plugins/jadx-script/examples/scripts</code>\u4e2d\uff0c\u4e0b\u9762\u4f1a\u4ecb\u7ecd\u5230\u3002</p> <p></p> <p>\u8ddf\u8e2a\u8fd9\u4e2a\u89e3\u5bc6\u7684\u51fd\u6570\uff0c\u80fd\u770b\u5230\u89e3\u5bc6\u7684\u903b\u8f91\u5e76\u4e0d\u590d\u6742\uff0c\u5b8c\u5168\u80fd\u591f\u76f4\u63a5\u590d\u73b0\uff0c\u90a3\u4e48\u6211\u4eec\u671f\u671b\u7684\u6548\u679c\uff0c\u80af\u5b9a\u662f\u5728\u9759\u6001\u5206\u6790\u65f6\u76f4\u63a5\u770b\u5230\u89e3\u5bc6\u540e\u7684\u7ed3\u679c\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u770b\u600e\u4e48\u8fbe\u5230\u8fd9\u4e2a\u6548\u679c\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u7b97\u6cd5\u8fd8\u539f\u7684\u811a\u672c\u5e76\u4ea4\u7ed9\u6700\u65b0\u7684<code>jadx</code>\u53bb\u6267\u884c</p> <p></p> <pre><code>/**\n * Replace method call with calculated result.\n * Useful for custom string deobfuscation.\n *\n * Example for sample from issue https://github.com/skylot/jadx/issues/1251\n */\n\nimport jadx.core.dex.instructions.ConstStringNode\nimport jadx.core.dex.instructions.InvokeNode\nimport jadx.core.dex.instructions.args.InsnArg\nimport jadx.core.dex.instructions.args.InsnWrapArg\nimport jadx.core.dex.instructions.args.RegisterArg\n\n\nval jadx = getJadxInstance()\n\nval mthSignature = \"com.xshield.aa.iIiIiiiiII(Ljava/lang/String;)Ljava/lang/String;\"\n\njadx.replace.insns { mth, insn -&gt;\nif (insn is InvokeNode &amp;&amp; insn.callMth.rawFullId == mthSignature) {\nval str = getConstStr(insn.getArg(0))\nif (str != null) {\nval resultStr = decode(str)\nlog.info { \"Decode '$str' to '$resultStr' in $mth\" }\nreturn@insns ConstStringNode(resultStr)\n}\n}\nnull\n}\n\nfun getConstStr(arg: InsnArg): String? {\nval insn = when (arg) {\nis InsnWrapArg -&gt; arg.wrapInsn\nis RegisterArg -&gt; arg.assignInsn\nelse -&gt; null\n}\nif (insn is ConstStringNode) {\nreturn insn.string\n}\nreturn null\n}\n\n/**\n * Decompiled method, automatically converted to Kotlin by IntelliJ Idea\n */\nfun decode(str: String): String {\nval length = str.length\nval cArr = CharArray(length)\nvar i = length - 1\nwhile (i &gt;= 0) {\nval i2 = i - 1\ncArr[i] = (str[i].code xor 'z'.code).toChar()\nif (i2 &lt; 0) {\nbreak\n}\ni = i2 - 1\ncArr[i2] = (str[i2].code xor '\\u000c'.code).toChar()\n}\nreturn String(cArr)\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u5df2\u7ecf\u590d\u73b0\u4e86\u89e3\u5bc6\u7684\u7b97\u6cd5\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u52a0\u8f7d\u811a\u672c\u4e86\uff0c\u5728GUI\u4e2d\u9009\u62e9<code>replace_method_call.jadx.kts</code>\uff0c\u6253\u5f00</p> <p></p> <p>\u6267\u884c\u811a\u672c\uff0c\u4f1a\u904d\u5386\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u8282\u70b9\uff0c\u5f53\u7b7e\u540d\u76f8\u7b26\u65f6\uff0c\u4f1a\u66ff\u6362\u4e3a\u89e3\u5bc6\u540e\u7684\u7ed3\u679c</p> <p></p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6b63\u5e38\u9006\u5411\u5206\u6790\u4e86</p>"},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/#demo-apk","title":"\u6848\u4f8b\u4e8c\uff1a\u67d0Demo APK","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u6848\u4f8b\uff0c\u6211\u4eec\u53d1\u73b0\u53ef\u4ee5\u901a\u8fc7\u9006\u5411\u7684\u624b\u6bb5\u8fd8\u539f\u7b97\u6cd5\uff0c\u4f46\u662f\u5982\u679c\u78b0\u5230\u4e0d\u80fd\u591f\u8fd8\u539f\u7684\u52a0\u5bc6\u65b9\u6cd5\uff0c\u662f\u4e0d\u662f\u5c31\u65e0\u6cd5\u89e3\u5bc6\u4e86\u5462\uff1f\u5176\u5b9e\u4e0d\u7136\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u6709<code>Frida</code>\u6216\u8005<code>unidbg</code>\uff0c\u8fd9\u4e24\u8005\u5728\u51fd\u6570\u7684\u4e3b\u52a8\u8c03\u7528\u4e0a\u90fd\u662f\u4e00\u628a\u597d\u624b\uff0c\u5177\u4f53\u7684\u5bf9\u6bd4\u5982\u4e0b\u8868\u6240\u793a</p> Java\u5c42\u51fd\u6570\u8c03\u7528 Native\u5c42\u51fd\u6570\u8c03\u7528 \u7a33\u5b9a\u6027 Frida \u53ef\u4ee5 \u53ef\u4ee5 \u4e0d\u7a33\u5b9a unidbg \u4e0d\u53ef\u4ee5 \u53ef\u4ee5 \u7a33\u5b9a <p>\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u5404\u81ea\u7684\u7279\u6027\u9009\u62e9\u4e3b\u52a8\u8c03\u7528\u7684\u5de5\u5177\uff0c\u8fd9\u91cc\u5148\u770b\u4e00\u4e2a<code>Demo</code>\u6848\u4f8b\uff0c\u4ee5<code>androidx.core.utils.CommenUtils$Companion.a</code>\u51fd\u6570\u4e3a\u4f8b</p> <p></p> <p>\u901a\u8fc7\u4e0a\u56fe\uff0c\u6211\u4eec\u80fd\u660e\u663e\u770b\u5230\u5173\u952e\u5b57\u7b26\u4e32\u5747\u91c7\u7528\u4e86\u52a0\u5bc6\uff0c\u90a3\u4e48\u770b\u4e00\u4e0b\u52a0\u5bc6\u51fd\u6570<code>C3632qz.b</code>\u7684\u5b9e\u73b0</p> <p></p> <p>\u53d1\u73b0\u8fd9\u91cc\u5b9e\u9645\u4e0a\u662fBase64\u7684\u89e3\u5bc6\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u811a\u672c\u4e2d\u5b9e\u73b0Base64\u7684\u89e3\u5bc6\u7b97\u6cd5\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u91c7\u7528\u53e6\u4e00\u79cd\u65b9\u5f0f\u89e3\u51b3\uff0c\u90a3\u5c31\u662f\u76f4\u63a5hook <code>C3632qz.b</code>\u51fd\u6570\uff0c\u8fdb\u800c\u4e3b\u52a8\u8c03\u7528\u8fd4\u56de\u7ed3\u679c\uff0c\u5177\u4f53\u600e\u4e48\u64cd\u4f5c\u5462\uff1f\u4e0a\u4ee3\u7801</p> <pre><code>// That is the path relative to the jadx/bin execution directory, or it can be changed to an absolute path.\n@file:DependsOn(\"../external_library/okhttp-4.11.0.jar\")\n@file:DependsOn(\"../external_library/okio-jvm-3.2.0.jar\")\n@file:DependsOn(\"../external_library/okio-3.2.0.jar\")\n\nimport okhttp3.MediaType.Companion.toMediaType\nimport okhttp3.OkHttpClient\nimport okhttp3.Request\nimport okhttp3.RequestBody.Companion.toRequestBody\nimport okhttp3.Response\n\nimport jadx.core.dex.instructions.ConstStringNode\nimport jadx.core.dex.instructions.InvokeNode\nimport jadx.core.dex.instructions.args.InsnArg\nimport jadx.core.dex.instructions.args.InsnWrapArg\nimport jadx.core.dex.instructions.args.RegisterArg\n\nval jadx = getJadxInstance()\n\nval mthSignature_qzb = \"kotlinx.android.extensionss.qz.b(Ljava/lang/String;)Ljava/lang/String;\"\n\njadx.replace.insns { mth, insn -&gt;\nif (insn is InvokeNode &amp;&amp; insn.callMth.rawFullId == mthSignature_qzb) {\nval str = getConstStr(insn.getArg(0))\nif (str != null) {\nval resultStr = decrypt(mthSignature_qzb, str)\nlog.info { \"Decrypt '$str' to '$resultStr' in $mth\" }\nreturn@insns ConstStringNode(resultStr)\n}\n}\nnull\n}\nfun getConstStr(arg: InsnArg): String? {\nval insn = when (arg) {\nis InsnWrapArg -&gt; arg.wrapInsn\nis RegisterArg -&gt; arg.assignInsn\nelse -&gt; null\n}\nif (insn is ConstStringNode) {\nreturn insn.string\n}\nreturn null\n}\n// rpc \u89e3\u5bc6\u51fd\u6570\nfun decrypt(mthSignature: String, param: String): String?{\nval client = OkHttpClient()\nval json = \"\"\"\n        {\n            \"method\": \"${mthSignature}\",\n            \"param\": \"${param}\"\n        }\n    \"\"\".trimIndent()\n\nval requestBody = json.toRequestBody(\"application/json; charset=utf-8\".toMediaType())\n\nval request = Request.Builder()\n.url(\"http://127.0.0.1:5000/decrypt\")\n.post(requestBody)\n.build()\n\nval response = client.newCall(request).execute()\nreturn response.body?.string().toString()\n}\n</code></pre> <p>\u80fd\u591f\u53d1\u73b0\uff0c\u5176\u5b9e\u811a\u672c\u7684\u4e3b\u4f53\u7ed3\u6784\u5e76\u6ca1\u6709\u592a\u5927\u7684\u53d8\u5316\uff0c\u4f46\u662f\u5728\u6838\u5fc3\u7684<code>decrypt</code>\u51fd\u6570\u4e0a\uff0c\u4f7f\u7528\u4e86<code>OkHttp</code>\u53d1\u9001\u8bf7\u6c42\uff0c\u5e76\u63a5\u53d7\u8fd4\u56de\u7684\u6570\u636e\uff0c\u5373\u662f\u5c06<code>jadx</code>\u4f5c\u4e3a\u4e86\u5ba2\u6237\u7aef\u3002\u65e2\u7136\u6709\u5ba2\u6237\u7aef\uff0c\u90a3\u4e48\u4e5f\u5f97\u6709\u670d\u52a1\u7aef\uff0c\u5982\u4e0b\u6240\u793a</p> <pre><code>...\napp = Flask(__name__)\nlogger = Logger(log_level=\"INFO\")\n\ndef message(message, data):\n    if message['type'] == 'send':\n        logger.debug(f\"[*] {message['payload']}\")\n    else:\n        logger.debug(message)\n\n@app.route('/decrypt', methods=['POST'])#data\u89e3\u5bc6\ndef decrypt_class():\n    data = request.get_data()\n    json_data = json.loads(data.decode(\"utf-8\"))\n    logger.info(json_data)\n    method_sig = json_data.get(\"method\")\n    method_param = handle_params(json_data.get(\"param\"))\n    logger.debug(f\"method: ${method_sig}; params: ${method_param}\") \n    handle_method = globals()[methods[method_sig]]\n    res = _process_string(handle_method(method_sig, method_param))\n    response = make_response(res, 200)\n    response.headers['Content-Type'] = 'application/json'\n    return response\n\ndef _process_string(s: str) -&gt; str:\n    s = ' '.join(s.split())\n    s = re.sub(r'\\s+', ' ', s)\n    if len(s) &gt; 0 and s[0] == ' ':\n        s = ' ' + s.lstrip()\n    if len(s) &gt; 0 and s[-1] == ' ':\n        s = s.rstrip() + ' '\n    return s\n\ndef handle_params(params):\n    return params\n\n#################### Method Handler ####################\n\ndef _handle_qz_b(method_name, method_param):\n    res = _process_string(script.exports_sync.invokemethod01(method_param))\n    logger.info(f\"{method_param} =&gt; {res}\")\n    return res\n\ndef _handle_cg_b(method_name, method_param):\n    res = _process_string(script.exports_sync.invokemethod02(method_param))\n    logger.info(f\"{method_param} =&gt; {res}\")\n    return res\n\n#################### Flask Server ####################\n\nconfig = Config.builder()\nmethods = config.methods_map\n\ndevice = frida.get_device_manager().add_remote_device(config.remote_device)\nif(config.spawn):\n    session = device.spawn(config.package_name)\nelse:\n    session = device.attach(config.app_name)\n\nwith open(os.path.join(os.path.dirname(os.path.abspath(__file__)), \"scripts\", config.frida_script_name)) as f:\n    jsCode = f.read()\n\nscript = session.create_script(jsCode)\nscript.on(\"message\",message)\nscript.load()\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", port=5000, debug=False)\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u7684\u76ee\u6807\u662f\u5982\u4f55\u5b8c\u6210RPC\u51fd\u6570\uff0c\u6545\u4e0d\u4f1a\u5bf9\u4e0a\u9762\u7684\u4ee3\u7801\u8fdb\u884c\u66f4\u6df1\u5165\u7684\u8bf4\u660e\uff0c\u4f46\u662f\u6709\u51e0\u4e2a\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u4e5f\u662f\u672c\u4eba\u8e29\u8fc7\u7684\u5751</p> <ul> <li>\u670d\u52a1\u7aef\u5904\u7406\u5b8c\u5b57\u7b26\u4e32\u6570\u636e\u540e\uff0c\u4e00\u5b9a\u8981\u5bf9\u5b57\u7b26\u4e32\u5185\u7684\u7a7a\u683c\u548c\u56de\u8f66\u505a\u5904\u7406\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u66ff\u6362\u56de\u53bb\u7684\u6570\u636e\u51fa\u73b0\u663e\u793a\u95ee\u9898</li> <li>\u5728<code>Frida</code> 15\u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0cattach\u64cd\u4f5c\u9700\u8981\u5e94\u7528\u7684\u540d\u79f0\uff0c\u7531\u4e8e\u7b14\u8005\u672c\u4eba\u4f7f\u7528\u7684\u662fFrida 16.0.19\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u4e5f\u505a\u4e86\u7279\u6b8a\u7684\u5904\u7406</li> <li>\u6211\u4eec\u53ef\u4ee5\u5728<code>Config</code>\u4e2d\u63d0\u524d\u8bbe\u7f6e\u597d\u65b9\u6cd5\u7b7e\u540d\u548c\u51fd\u6570\u7684\u5bf9\u5e94\uff0c\u4f8b\u5982<code>\"kotlinx.android.extensionss.qz.b(Ljava/lang/String;)Ljava/lang/String;\": \"_handle_qz_b\"</code>\uff0c\u8fd9\u6837\u5c31\u80fd\u6839\u636e\u4e0d\u540c\u7684\u7b7e\u540d\u8d70\u4e0d\u540c\u7684\u4e3b\u52a8\u8c03\u7528</li> </ul> <p>\u5f00\u542fFrida\uff0c\u542f\u52a8PC\u7aefserver\uff0c\u6267\u884c\u811a\u672c\uff0c\u80fd\u591f\u770b\u5230\u5927\u90e8\u5206\u5185\u5bb9\u5df2\u7ecf\u88ab\u89e3\u5bc6\u4e86</p> <p></p> <p>\u4f46\u662f\u6b64\u65f6\u8fd8\u9700\u8981\u6ce8\u610f\u4e00\u4e0b<code>CornerTreatment.b(\"237A88EB\")</code>\uff0c\u8fd9\u770b\u4e0a\u53bb\u4e5f\u662f\u4e00\u4e2a\u89e3\u5bc6\uff0c\u8ddf\u8fdb\u53bb\u770b\u770b</p> <p></p> <p>\u679c\u4e0d\u5176\u7136\uff0c\u8fd9\u91cc\u4e5f\u662f\u4e00\u5c42\u52a0\u5bc6\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u4e2aDemo\u4e2d\u4e5f\u5b58\u5728\u7740\u5f88\u591a\u8fd9\u79cd\u5d4c\u5957\u89e3\u5bc6</p> <p></p> <p>\u867d\u7136\u591a\u4e86\u4e00\u5c42\u89e3\u5bc6\uff0c\u4f46\u662f\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u5982\u6cd5\u70ae\u5236\uff0c\u518d\u4e0a\u4e00\u4e2a\u89e3\u5bc6\u7684\u63d2\u4ef6\uff0c\u8fd9\u6837\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\uff0c\u53cc\u5c42\u5d4c\u5957\u89e3\u5bc6\u4e5f\u80fd\u88ab\u5e72\u6389</p> <p></p> <p></p> <p>\u5f53\u5b57\u7b26\u4e32\u7684\u6df7\u6dc6\u6d88\u5931\u4e4b\u540e\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u66f4\u597d\u5730\u5206\u6790\u5e94\u7528\u7684\u884c\u4e3a\uff0c\u4e5f\u53ef\u4ee5\u5c06patch\u540e\u7684\u9879\u76ee\u5bfc\u51fa\u7528\u4e8e\u9759\u6001\u68c0\u6d4b\u3002</p>"},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/#_2","title":"\u603b\u7ed3","text":"<p>\u4e0a\u9762\u7684\u6848\u4f8b\u4e2d\u6211\u4eec\u53ea\u4f7f\u7528\u4e86Frida\u8fdb\u884c\u4e86\u5b57\u7b26\u4e32\u7684\u8fd8\u539f\uff0c\u5b9e\u9645\u4e0a\uff0c\u4e5f\u5b58\u5728App\u5c06\u5b57\u7b26\u4e32\u89e3\u5bc6\u7684\u51fd\u6570\u653e\u5728Native\u4e2d\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u66f4\u52a0\u7a33\u5b9a\u7684unidbg\u53bb\u89e3\u4e86\uff0c\u7b14\u8005\u5728\u8fd9\u91cc\u53ea\u662f\u5f15\u51fa\u4e00\u4e2a\u601d\u8def\uff0c\u5173\u4e8eunidbg\u7684\u4f7f\u7528\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\u3002\u603b\u800c\u8a00\u4e4b\uff0c\u53ea\u8981\u80fd\u901a\u8fc7\u8fd9\u79cd<code>jadx</code>\u811a\u672c\u7684\u65b9\u5f0f\u7ee7\u7eedpatch\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u52a0\u5bc6\u7684\u95ee\u9898\u5c31\u4e0d\u518d\u4f1a\u6210\u4e3a\u9006\u5411\u5206\u6790\u7684\u65f6\u95f4\u6210\u672c\uff0c\u7b14\u8005\u4e5f\u5c06\u76f8\u5173\u7684\u4ee3\u7801\u548c\u6700\u65b0\u7248\u7f16\u8bd1\u7684<code>jadx</code>\u4e00\u5e76\u653e\u51fa\uff0c\u53ef\u4f9b\u53c2\u8003\u3002</p> <p>jygzyc/apkDeobfuscation (github.com)</p>"},{"location":"Android/Android%E9%80%86%E5%90%91%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8F%8D%E6%B7%B7%E6%B7%86/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>MegatronKing/StringFog: \u4e00\u6b3e\u81ea\u52a8\u5bf9\u5b57\u8282\u7801\u4e2d\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u52a0\u5bc6Android\u63d2\u4ef6\u5de5\u5177 (github.com)</li> <li>frida/frida: Clone this repo to build Frida (github.com)</li> <li>skylot/jadx: Dex to Java decompiler (github.com)</li> </ul>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/","title":"\u5185\u6838\u7f16\u8bd1\u4e0eKernelSU\u96c6\u6210","text":""},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_1","title":"\u5185\u6838\u7f16\u8bd1","text":""},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_2","title":"\u786e\u8ba4\u624b\u673a\u4fe1\u606f","text":"<p>\u5728Android\u7ec8\u7aef\u6267\u884c<code>getprop | grep device</code>\uff0c\u5e76\u5bfb\u627e\u5f62\u4f3c <code>ro.xx.device</code> \u8fd9\u4e00\u884c\uff0c\u91cc\u9762\u7684\u5185\u5bb9\u5373\u4e3a\u4f60\u7684\u624b\u673a\u4ee3\u53f7\uff0c\u8fd9\u91cc\u6211\u7684\u624b\u673a\u662fGoogle Pixel 3 \uff0c\u578b\u53f7\u5982\u4e0b\u6240\u793a</p> <p></p> <p>\u4e4b\u540e\u9700\u8981\u83b7\u53d6\u8bbe\u5907\u67b6\u6784\uff0c\u6267\u884c<code>uname -m</code>\uff0c\u8fd9\u91cc\u6211\u7684\u8bbe\u5907\u663e\u793a\u662f<code>aarch64</code></p> <p>\u6700\u540e\u4e00\u6b65\u662f\u83b7\u53d6\u5f53\u524d\u8bbe\u5907\u7684\u5185\u6838\u7248\u672c\uff0c\u6267\u884c<code>uname -r</code>\uff0c\u8fd9\u91cc\u6211\u7684\u8bbe\u5907\u663e\u793a\u662f <code>4.9.337-NekoMiya+</code></p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_3","title":"\u540c\u6b65\u5185\u6838\u6e90\u7801","text":""},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_4","title":"\u76f4\u63a5\u540c\u6b65\u5185\u6838\u6e90\u7801","text":"<p>\u5148\u627e\u5230Pixel3\u7684\u5185\u6838\u6e90\u7801\uff0c\u7531\u4e8e\u8fd9\u91cc\u7528\u7684\u662fPixelExperience\uff0c\u6240\u4ee5\u5230Github\u4e0a\u80fd\u627e\u5230\u6e90\u7801\u7684\u76ee\u5f55 PixelExperience-Devices/kernel_google_bluecross: Dependency of Google Pixel 3 (blueline), Google Pixel 3 XL (crosshatch) (github.com)</p> <p>\u5982\u679c\u60f3\u7f16\u8bd1AOSP\u7684\u5185\u6838\uff0c\u90a3\u4e48\u53ef\u4ee5\u67e5\u770bGoogle\u7684\u5b98\u65b9\u6307\u5bfc\u6784\u5efa\u5185\u6838  | Android \u5f00\u6e90\u9879\u76ee  | Android Open Source Project</p> <p>\u5206\u652f\u7684\u8bdd\u67094\u4e2a\uff0c\u8fd9\u91cc\u9009\u6700\u65b0\u7684 <code>thirteen-plus</code></p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#repo","title":"\u901a\u8fc7repo\u83b7\u53d6\u5185\u6838\u6e90\u7801","text":"<p>\u7531\u4e8e\u6211\u8fd9\u8fb9\u4e5f\u9700\u8981\u7f16\u8bd1\u6574\u673a\u4ee3\u7801\uff0c\u52a0\u4e0a\u5de5\u5177\u94fe\u672c\u8eab\u4e5f\u6bd4\u8f83\u590d\u6742\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u4e00\u5e76\u90fd\u4f7f\u7528<code>repo</code>\u540c\u6b65\u4e0b\u6765\u4e86\u3002</p> <p></p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_5","title":"\u7f16\u8bd1","text":"<p>\u7531\u4e8e\u6211\u8fd9\u8fb9\u76f4\u63a5\u4f7f\u7528\u4e86repo\uff0c\u6240\u4ee5\u6267\u884c<code>make bootimage</code>\uff0c\u6700\u540e\u53ef\u4ee5\u5728\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u627e\u5230<code>boot.img</code></p> <p></p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#kernelsu","title":"KernelSU","text":"<p>\u8fd9\u91cc\u6211\u4eec\u53c2\u8003\u5b98\u65b9\u7684\u6559\u7a0b\uff0c\u94fe\u63a5\u4e3a\u5982\u4f55\u4e3a\u975e GKI \u5185\u6838\u96c6\u6210 KernelSU\uff0c\u5e76\u4f7f\u7528 <code>kprobe</code> \u96c6\u6210</p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#kprobe","title":"Kprobe\u914d\u7f6e","text":"<p>\u5148\u8fdb\u5165\u5230\u5185\u6838\u6e90\u7801\u76ee\u5f55\u4e0b\uff0c\u5728\u6839\u76ee\u5f55\u65b0\u5efa\u5206\u652f\uff0c\u8fd9\u91cc\u547d\u540d\u4e3a<code>kernelsu</code></p> <pre><code>git checkout -b kernelsu # \u6b64\u5904\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u65b9\u4fbf\u4e4b\u540e\u8fdb\u884c\u540c\u6b65\u548c\u66f4\u6539\n</code></pre> <p>\u5efa\u7acb\u5b8c\u6210\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>curl -LSs \"https://raw.githubusercontent.com/tiann/KernelSU/main/kernel/setup.sh\" | bash -\n</code></pre> <p></p> <p>\u63a5\u7740\u68c0\u67e5\u5185\u6838\u662f\u5426\u5f00\u542f\u4e86<code>kprobe</code>\uff0c\u5728<code>arch/arm64/configs/b1c1_defconfig</code>\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e</p> <pre><code># KPROBE config\nCONFIG_KPROBES=y\nCONFIG_HAVE_KPROBES=y\nCONFIG_KPROBE_EVENTS=y\n</code></pre> <p></p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_6","title":"\u4fee\u6539\u6587\u4ef6","text":"<ul> <li>\u4fee\u6539<code>build.config.bluecross</code></li> </ul> <p>\u5728<code>build.config.bluecross</code>\u4e2d\u6ce8\u91ca\u6389<code>POST_DEFCONFIG_CMDS</code>\u8fd9\u4e00\u884c\uff0c\u5426\u5219\u7f16\u8bd1\u4f1a\u62a5\u9519</p> <p></p> <ul> <li>\u4fee\u6539<code>fs/exec.c</code>\u4e2d\u7684do_execveat_common</li> </ul> <p></p> <pre><code>// kernelsu add\nextern int ksu_handle_execveat(int *fd, struct filename **filename_ptr, void *argv,\nvoid *envp, int *flags);\n// kernelsu end\n\n/*\n * sys_execve() executes a new program.\n */\nstatic int do_execveat_common(int fd, struct filename *filename,\nstruct user_arg_ptr argv,\nstruct user_arg_ptr envp,\nint flags)\n{\nchar *pathbuf = NULL;\nstruct linux_binprm *bprm;\nstruct file *file;\nstruct files_struct *displaced;\nint retval;\n\n// kernelsu add\nksu_handle_execveat(&amp;fd, &amp;filename, &amp;argv, &amp;envp, &amp;flags);\n// kernelsu end\n\nif (IS_ERR(filename))\nreturn PTR_ERR(filename);\n...\n</code></pre> <ul> <li>\u4fee\u6539<code>fs/open.c</code>\uff0c\u627e\u5230faccessat\u7684\u7cfb\u7edf\u8c03\u7528\u5b9a\u4e49\u5e76\u4fee\u6539</li> </ul> <p></p> <pre><code>// kernelsu add\nextern int ksu_handle_faccessat(int *dfd, const char __user **filename_user, int *mode,\nint *flags);\n// kernelsu end\n\n/*\n * access() needs to use the real uid/gid, not the effective uid/gid.\n * We do this by temporarily clearing all FS-related capabilities and\n * switching the fsuid/fsgid around to the real ones.\n */\nSYSCALL_DEFINE3(faccessat, int, dfd, const char __user *, filename, int, mode)\n{\nconst struct cred *old_cred;\nstruct cred *override_cred;\nstruct path path;\nstruct inode *inode;\nstruct vfsmount *mnt;\nint res;\nunsigned int lookup_flags = LOOKUP_FOLLOW;\n\n// kernelsu add\nksu_handle_faccessat(&amp;dfd, &amp;filename, &amp;mode, NULL);\n// kernelsu end\n\nif (mode &amp; ~S_IRWXO)\n...\n</code></pre> <ul> <li>\u4fee\u6539<code>fs/read_write.c</code>\u4e2d\u7684vfs_read</li> </ul> <p></p> <pre><code>// kernelsu add\nextern int ksu_handle_vfs_read(struct file **file_ptr, char __user **buf_ptr,\nsize_t *count_ptr, loff_t **pos);\n// kernelsu end\n\nssize_t vfs_read(struct file *file, char __user *buf, size_t count, loff_t *pos)\n{\nssize_t ret;\n\n// kernelsu add\nksu_handle_vfs_read(&amp;file, &amp;buf, &amp;count, &amp;pos);\n// kernelsu end\nif (!(file-&gt;f_mode &amp; FMODE_READ))\n...\n</code></pre> <ul> <li>\u4fee\u6539<code>fs/stat.c</code>\u4e2d\u7684vfs_fstatat\uff08Pixel 3\u4e2d\u9002\u914d\u7684\u65e7\u7248\u672c\u5185\u6838\u6ca1\u6709<code>vfs_statx</code>\u51fd\u6570\uff09</li> </ul> <p></p> <pre><code>// kernelsu add\nextern int ksu_handle_stat(int *dfd, const char __user **filename_user, int *flags);\n// kernelsu end\n\nint vfs_fstatat(int dfd, const char __user *filename, struct kstat *stat,\nint flag)\n{\nstruct path path;\nint error = -EINVAL;\nunsigned int lookup_flags = 0;\n\n// kernelsu add\nksu_handle_stat(&amp;dfd, &amp;filename, &amp;flag);\n// kernelsu end\n...\n</code></pre> <ul> <li>\u6253\u5f00 KernelSU\u5185\u7f6e\u7684\u5b89\u5168\u6a21\u5f0f\uff0c\u4fee\u6539<code>drivers/input/input.c</code>\u4e2d\u7684<code>input_handle_event</code> \u65b9\u6cd5</li> </ul> <p></p> <pre><code>// kernelsu add\nextern int ksu_handle_input_handle_event(unsigned int *type, unsigned int *code, int *value);\n// kernelsu end\n\nstatic void input_handle_event(struct input_dev *dev,\nunsigned int type, unsigned int code, int value)\n{\nint disposition = input_get_disposition(dev, type, code, &amp;value);\n\n// kernelsu add\nksu_handle_input_handle_event(&amp;type, &amp;code, &amp;value);\n// kernelsu end\nif (disposition != INPUT_IGNORE_EVENT &amp;&amp; type != EV_SYN)\nadd_input_randomness(type, code, value);\n...\n</code></pre> <p>\u7f16\u8bd1\u7684\u8fc7\u7a0b\u5c31\u548c\u4e0a\u9762\u7684\u6b65\u9aa4\u662f\u4e00\u6837\u7684</p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_7","title":"\u7ed3\u679c\u9a8c\u8bc1","text":"<p>\u4f7f\u7528<code>adb reboot bootloader</code>\u91cd\u542f\u5230<code>bootloader</code>\uff0c\u5c06\u7f16\u8bd1\u597d\u7684<code>boot.img</code>\u4f7f\u7528<code>fastboot flash boot boot.img</code>\u5237\u5230\u624b\u673a\u91cc\uff0c\u542f\u52a8\u624b\u673a\uff0c\u5b89\u88c5KernelSU\u7ba1\u7406\u5668\uff0c\u5373\u53ef\u770b\u5230KernelSU\u6b63\u5e38\u5de5\u4f5c</p> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5feb\u4e50\u73a9\u800d\u4e86\uff01</p>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_8","title":"\u5185\u6838\u540c\u6b65","text":"<p>\u5728\u4e0a\u8ff0\u5185\u6838\u4fee\u6539\u7ed3\u675f\u540e\uff0c\u53ef\u4ee5\u5c06\u5b9a\u5236\u7684\u5185\u6838\u6587\u4ef6\u540c\u6b65\u5230\u81ea\u5df1\u7684github\u4e0a\uff0c\u65b9\u4fbf\u4ee5\u540e\u7684\u66f4\u65b0\uff0c\u4fee\u6539\u548c\u7f16\u8bd1</p> <pre><code>$ git remote add kernelsu git@github.com:jygzyc/kernel_google_bluecross_KernelSU.git # \u6dfb\u52a0\u8fdc\u7a0b\u5206\u652f\n$ git add .\n$ git commit -m \"KernelSU Adaptation\"\n$ git push -u kernelsu kernelsu:thirteen-plus # \u9996\u6b21\u5c06kernelsu\u5206\u652f\u63a8\u5230\u8fdc\u7a0bkernelsu\u4ed3\u5e93\u7684thirteen-plus\u5206\u652f\n</code></pre> <p>\u4e4b\u540e\u5982\u679c\u5185\u6838\u4ee3\u7801\u66f4\u65b0\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5408\u5e76\u5904\u7406</p> <pre><code>$ git fetch pixel-devices thirteen-plus # \u4ece\u8fdc\u7a0b\u4ed3\u5e93pixel-devices\u62c9\u53d6thirteen-plus\u7684\u4ee3\u7801\n\n$ git checkout kernelsu  # \u5207\u6362\u5230\u672c\u5730\u5206\u652f\n$ git merge # \u5c06\u8fdc\u7a0b\u5206\u652f\u5408\u5e76\u5230\u672c\u5730\u5206\u652f\n\n$ git push kernelsu kernelsu:thirteen-plus # \u5c06kernelsu\u5206\u652f\u63a8\u5230\u8fdc\u7a0bkernelsu\u4ed3\u5e93\u7684thirteen-plus\u5206\u652f\n</code></pre>"},{"location":"Android/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%B8%8EKernelSU%E9%9B%86%E6%88%90/#_9","title":"\u53c2\u8003\u6587\u732e","text":"<p>Android\u4ece\u96f6\u5f00\u59cb\u7684\u5185\u6838\u7f16\u8bd1 - \u6398\u91d1 (juejin.cn)</p> <p>\u5982\u4f55\u4e3a\u975e GKI \u5185\u6838\u96c6\u6210 KernelSU | KernelSU</p> <p>AOSP\u7f16\u8bd1\u4fdd\u59c6\u7ea7\u6559\u7a0b\uff08\u4e09\uff09-KernelSU (qq.com)</p>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/","title":"Frida\u7f16\u8bd1\u4e0epatch","text":""},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#frida","title":"Frida\u7f16\u8bd1","text":""},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#_1","title":"\u4ee3\u7801\u540c\u6b65\u4e0e\u73af\u5883\u51c6\u5907","text":"<p>Windows 11 + vmware Ubuntu 22.04 \u865a\u62df\u673a\uff0c\u5728\u865a\u62df\u673a\u4e2d\u8fdb\u884c\u4e86\u64cd\u4f5c</p> <p>\u4f7f\u7528<code>git clone --recurse-submodules https://github.com/frida/frida.git</code>\u5373\u53ef\u540c\u6b65Frida\u7684\u5168\u90e8\u4ee3\u7801\uff0c\u5982\u679c\u8981\u4f7f\u7528\u7279\u5b9atag\u7684\u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u7684\u547d\u4ee4\u521b\u5efa\u65b0\u7684\u5206\u652f\uff0c\u8fd9\u91cc\u4ee5\u7b14\u8005\u6700\u65b0\u768416.0.19\u7248\u672c\u4e3a\u4f8b</p> <pre><code>$ git checkout -b branch-16.0.19 16.0.19\nSwitched to a new branch 'branch-16.0.19'\n</code></pre> <p>\u8fd9\u6837\u7684\u8bdd\u5c31\u5207\u6362\u5230\u4e86\u521b\u5efa\u7684\u5206\u652f\uff0c\u5e76\u53ef\u4ee5\u57fa\u4e8e\u8be5\u5206\u652f\u4fee\u6539\u6587\u4ef6\u4e86\uff0c\u8fd9\u91cc\u6211\u65b0\u5efa\u4e00\u4e2a\u57fa\u4e8emain\u7684\u5206\u652f\u5e76\u8fdb\u884c\u4fee\u6539</p> <p>\u60f3\u8981\u7f16\u8bd1Frida\uff0c\u9996\u5148\u8981\u914d\u7f6e\u597d\u5bf9\u5e94\u7684NDK\u7248\u672c\uff0c\u6211\u4eec\u5728<code>frida/releng/setup-env.sh</code>\u4e0b\u80fd\u591f\u627e\u5230<code>ndk_required</code>\uff0c\u8fd9\u91cc\u8bf4\u660e\u4e86\u6240\u9700\u7684NDK\u7248\u672c</p> <pre><code>...\nif [ \"$host_os\" == \"android\" ]; then\nndk_required=25\nif [ -n \"$ANDROID_NDK_ROOT\" ] &amp;&amp; [ -e \"$ANDROID_NDK_ROOT\" ]; then\nif [ -f \"$ANDROID_NDK_ROOT/source.properties\" ]; then\nndk_installed_version=$(grep Pkg.Revision \"$ANDROID_NDK_ROOT/source.properties\" | awk '{ split($NF, v, \".\"); print v[1]; }')\nelse\nndk_installed_version=$(cut -f1 -d\" \" \"$ANDROID_NDK_ROOT/RELEASE.TXT\")\n...\n</code></pre> <p>\u4ee5\u6587\u7ae0\u7f16\u5199\u65f6\u7684\u6700\u65b0\u7248\u672c\u4e3a\u4f8b\uff0c\u8fd9\u91cc\u80fd\u770b\u5230\u9700\u8981\u7684Android NDK version \u662f25\uff0c\u4e0b\u8f7dNDK\u5e76\u5b89\u88c5</p> <pre><code>wget https://dl.google.com/android/repository/android-ndk-r25c-linux.zip\nunzip android-ndk-r25c-linux.zip\necho 'export ANDROID_NDK_ROOT=/home/ecool/Tools/android-ndk-r25c' &gt;&gt; ~/.zshrc\necho 'export PATH=$ANDROID_NDK_ROOT:$PATH' &gt;&gt; ~/.zshrc\nsource ~/.zshrc\n</code></pre> <p>\u9664\u6b64\u4ee5\u5916\uff0c\u8fd8\u9700\u8981\u5b89\u88c5Python\u548cNodejs\uff0c\u6267\u884c\u5b98\u7f51\u7684\u547d\u4ee4\u5373\u53ef</p> <pre><code>sudo apt-get install build-essential curl git lib32stdc++-9-dev \\\nlibc6-dev-i386 nodejs npm python3-dev python3-pip\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#_2","title":"\u7f16\u8bd1","text":"<p>\u8fdb\u5165<code>frida</code>\u4e3b\u76ee\u5f55\u540e\u6267\u884c<code>make core-android-arm64</code>\u5373\u53ef\u8fdb\u884c\u7f16\u8bd1\uff0c\u5728\u8fd9\u671f\u95f4\u9700\u8981\u79d1\u5b66\u4e0a\u7f51\uff0c\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u4f1a\u4e0b\u8f7d\u6240\u9700\u7684SDK\u6587\u4ef6\uff0c\u4e00\u5207\u987a\u5229\u7684\u8bdd\uff0c\u4f1a\u663e\u793a<code>Compilation succeeded</code></p> <pre><code>[23/102] Compiling Vala source src/frida-data-android.vapi src/frida-data-helper-process.vapi src/fri...ler/compiler.vala src/frida-helper-backend.vapi lib/base/frida-base-1.0.vapi lib/pipe/frida-pipe.vapi\nglib-2.0.vapi:1638.1-1638.14: warning: Namespace `GLib' does not have a GIR namespace and version annotation\n 1638 | namespace GLib {\n      | ^~~~~~~~~~~~~~\nCompilation succeeded - 1 warning(s)\n[102/102] Linking target tests/frida-tests\nInstalling lib/base/libfrida-base-1.0.a to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib\nInstalling lib/base/frida-base.h to /home/ecool/SourceCode/frida/build/frida-android-arm64/include/frida-1.0\nInstalling lib/base/frida-base-1.0.vapi to /home/ecool/SourceCode/frida/build/frida-android-arm64/share/vala/vapi\nInstalling lib/payload/libfrida-payload-1.0.a to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib\nInstalling lib/payload/frida-payload.h to /home/ecool/SourceCode/frida/build/frida-android-arm64/include/frida-1.0\nInstalling lib/payload/frida-payload-1.0.vapi to /home/ecool/SourceCode/frida/build/frida-android-arm64/share/vala/vapi\nInstalling lib/gadget/frida-gadget.so to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib/frida/64\nInstalling src/api/frida-core.h to /home/ecool/SourceCode/frida/build/frida-android-arm64/include/frida-1.0\nInstalling src/api/frida-core-1.0.vapi to /home/ecool/SourceCode/frida/build/frida-android-arm64/share/vala/vapi\nInstalling src/api/frida-core-1.0.deps to /home/ecool/SourceCode/frida/build/frida-android-arm64/share/vala/vapi\nInstalling src/api/libfrida-core-1.0.a to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib\nInstalling server/frida-server to /home/ecool/SourceCode/frida/build/frida-android-arm64/bin\nInstalling portal/frida-portal to /home/ecool/SourceCode/frida/build/frida-android-arm64/bin\nInstalling inject/frida-inject to /home/ecool/SourceCode/frida/build/frida-android-arm64/bin\nInstalling /home/ecool/SourceCode/frida/frida-core/lib/selinux/frida-selinux.h to /home/ecool/SourceCode/frida/build/frida-android-arm64/include/frida-1.0/\nInstalling /home/ecool/SourceCode/frida/build/tmp-android-arm64/frida-core/meson-private/frida-base-1.0.pc to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib/pkgconfig\nInstalling /home/ecool/SourceCode/frida/build/tmp-android-arm64/frida-core/meson-private/frida-payload-1.0.pc to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib/pkgconfig\nInstalling /home/ecool/SourceCode/frida/build/tmp-android-arm64/frida-core/meson-private/frida-core-1.0.pc to /home/ecool/SourceCode/frida/build/frida-android-arm64/lib/pkgconfig\nmake[1]: Leaving directory '/home/ecool/SourceCode/frida'\n</code></pre> <p>\u5728<code>frida/build/frida-android-arm64/bin</code>\u6587\u4ef6\u5939\u4e0b\u4f1a\u6709\u751f\u6210\u7684<code>frida-server</code>\u6587\u4ef6</p>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#frida-patch","title":"Frida Patch","text":"<p>\u8fd9\u91cc\u4e3b\u8981\u53c2\u8003\u7684\u662fhluwa\u5927\u4f6c\u5bf9Frida\u7684patches\uff0c\u4e14\u4f9d\u7167 .kk\u5927\u4f6c\u7684\u6587\u7ae0\u505a\u4e86\u90e8\u5206\u7684\u4fee\u6539</p>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#16019","title":"16.0.19\u7248\u672c","text":"<p>\u8fd9\u91cc\u6ca1\u6709\u4fee\u6539\u8fd0\u884c\u9ed8\u8ba4\u76ee\u5f55\uff08<code>/data/local/tmp</code>\uff09\uff0c\u4e5f\u6ca1\u6709\u4fee\u6539\u9ed8\u8ba4\u7aef\u53e3\uff0827042\uff09\uff0c\u5982\u679c\u6709\u9700\u8981\u53ef\u4ee5\u81ea\u884c\u4fee\u6539\u3002</p>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0001-ecool_string_frida_rpcpatch","title":"0001-ecool_string_frida_rpc.patch","text":"<pre><code>From ea51ce9bccec1391f0050dcf6aa1e075a93b1cbd Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 00:04:24 +0800\nSubject: [PATCH] 0001_ecool_string_frida_rpc\n\n---\n lib/base/rpc.vala | 6 +++---\n 1 file changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/lib/base/rpc.vala b/lib/base/rpc.vala\nindex 3695ba8c..02602abf 100644\n--- a/lib/base/rpc.vala\n+++ b/lib/base/rpc.vala\n@@ -17,7 +17,7 @@ namespace Frida {\nvar request = new Json.Builder ();\nrequest\n                .begin_array ()\n-               .add_string_value (\"frida:rpc\")\n+               .add_string_value ((string) GLib.Base64.decode(\"ZnJpZGE6cnBj=\"))\n.add_string_value (request_id)\n.add_string_value (\"call\")\n.add_string_value (method)\n@@ -70,7 +70,7 @@ namespace Frida {\n}\n\npublic bool try_handle_message (string json) {\n-           if (json.index_of (\"\\\"frida:rpc\\\"\") == -1)\n+           if (json.index_of ((string) GLib.Base64.decode(\"ImZyaWRhOnJwYyI=\")) == -1)\nreturn false;\n\nvar parser = new Json.Parser ();\n@@ -99,7 +99,7 @@ namespace Frida {\nreturn false;\n\nstring? type = rpc_message.get_element (0).get_string ();\n-           if (type == null || type != \"frida:rpc\")\n+           if (type == null || type != (string) GLib.Base64.decode(\"ZnJpZGE6cnBj=\"))\nreturn false;\n\nvar request_id_value = rpc_message.get_element (1);\n-- 2.34.1\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0002-ecool_io_re_frida_serverpatch","title":"0002-ecool_io_re_frida_server.patch","text":"<pre><code>From 398c83b1ac39586687355238a850ffa6fd194b46 Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 00:18:50 +0800\nSubject: [PATCH] ecool_io_re_frida_server\n\n---\n server/server.vala | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/server/server.vala b/server/server.vala\nindex b758be07..44fb51fc 100644\n--- a/server/server.vala\n+++ b/server/server.vala\n@@ -1,7 +1,7 @@\n namespace Frida.Server {\nprivate static Application application;\n\n-   private const string DEFAULT_DIRECTORY = \"re.frida.server\";\n+   private const string DEFAULT_DIRECTORY = \"re.ecool.server\";\nprivate static bool output_version = false;\nprivate static string? listen_address = null;\nprivate static string? certpath = null;\n-- 2.34.1\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0003-ecool_io_frida_agent_sopatch","title":"0003-ecool_io_frida_agent_so.patch","text":"<pre><code>From 0e21fac70c897fc3d9d7d7fc05a6394f0e28697a Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 00:26:12 +0800\nSubject: [PATCH] ecool_io_frida_agent_so\n\n---\n src/linux/linux-host-session.vala | 7 ++++---\n 1 file changed, 4 insertions(+), 3 deletions(-)\n\ndiff --git a/src/linux/linux-host-session.vala b/src/linux/linux-host-session.vala\nindex 50470ac8..87d41dba 100644\n--- a/src/linux/linux-host-session.vala\n+++ b/src/linux/linux-host-session.vala\n@@ -128,12 +128,13 @@ namespace Frida {\nvar blob64 = Frida.Data.Agent.get_frida_agent_64_so_blob ();\nvar emulated_arm = Frida.Data.Agent.get_frida_agent_arm_so_blob ();\nvar emulated_arm64 = Frida.Data.Agent.get_frida_agent_arm64_so_blob ();\n-           agent = new AgentDescriptor (PathTemplate (\"frida-agent-&lt;arch&gt;.so\"),\n+           var random_prefix = \"ecool\" + GLib.Uuid.string_random();\n+           agent = new AgentDescriptor (PathTemplate (random_prefix + \"-&lt;arch&gt;.so\"),\n                new Bytes.static (blob32.data),\n                new Bytes.static (blob64.data),\n                new AgentResource[] {\n-                   new AgentResource (\"frida-agent-arm.so\", new Bytes.static (emulated_arm.data), tempdir),\n-                   new AgentResource (\"frida-agent-arm64.so\", new Bytes.static (emulated_arm64.data), tempdir),\n+                   new AgentResource (random_prefix + \"-arm.so\", new Bytes.static (emulated_arm.data), tempdir),\n+                   new AgentResource (random_prefix + \"-arm64.so\", new Bytes.static (emulated_arm64.data), tempdir),\n                },\n                AgentMode.INSTANCED,\n                tempdir);\n-- 2.34.1\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0004-ecool_frida_agent_mainpatch","title":"0004-ecool_frida_agent_main.patch","text":"<pre><code>From ec2c51fbf123462bc5cf194aa5e9304e5059f622 Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 00:33:09 +0800\nSubject: [PATCH] ecool_frida_agent_main\n\n---\n src/agent-container.vala              | 2 +-\n src/darwin/darwin-host-session.vala   | 2 +-\n src/freebsd/freebsd-host-session.vala | 2 +-\n src/linux/linux-host-session.vala     | 2 +-\n src/qnx/qnx-host-session.vala         | 2 +-\n src/windows/windows-host-session.vala | 2 +-\n 6 files changed, 6 insertions(+), 6 deletions(-)\n\ndiff --git a/src/agent-container.vala b/src/agent-container.vala\nindex a8db6b29..ae9c3451 100644\n--- a/src/agent-container.vala\n+++ b/src/agent-container.vala\n@@ -25,7 +25,7 @@ namespace Frida {\nassert (container.module != null);\n\nvoid * main_func_symbol;\n-           var main_func_found = container.module.symbol (\"frida_agent_main\", out main_func_symbol);\n+           var main_func_found = container.module.symbol (\"ecool_main\", out main_func_symbol);\nassert (main_func_found);\ncontainer.main_impl = (AgentMainFunc) main_func_symbol;\n\ndiff --git a/src/darwin/darwin-host-session.vala b/src/darwin/darwin-host-session.vala\nindex 2e9c010b..8e4f2235 100644\n--- a/src/darwin/darwin-host-session.vala\n+++ b/src/darwin/darwin-host-session.vala\n@@ -354,7 +354,7 @@ namespace Frida {\nprivate async uint inject_agent (uint pid, string agent_parameters, Cancellable? cancellable) throws Error, IOError {\nuint id;\n\n-           unowned string entrypoint = \"frida_agent_main\";\n+           unowned string entrypoint = \"ecool_main\";\n#if HAVE_EMBEDDED_ASSETS\nid = yield fruitjector.inject_library_resource (pid, agent, entrypoint, agent_parameters, cancellable);\n#else\ndiff --git a/src/freebsd/freebsd-host-session.vala b/src/freebsd/freebsd-host-session.vala\nindex a2204a4e..459f7697 100644\n--- a/src/freebsd/freebsd-host-session.vala\n+++ b/src/freebsd/freebsd-host-session.vala\n@@ -197,7 +197,7 @@ namespace Frida {\n\nvar stream_request = Pipe.open (t.local_address, cancellable);\n\n-           var id = yield binjector.inject_library_resource (pid, agent_desc, \"frida_agent_main\",\n+           var id = yield binjector.inject_library_resource (pid, agent_desc, \"ecool_main\",\n                make_agent_parameters (pid, t.remote_address, options), cancellable);\ninjectee_by_pid[pid] = id;\n\ndiff --git a/src/linux/linux-host-session.vala b/src/linux/linux-host-session.vala\nindex 87d41dba..d8442fdb 100644\n--- a/src/linux/linux-host-session.vala\n+++ b/src/linux/linux-host-session.vala\n@@ -427,7 +427,7 @@ namespace Frida {\nprotected override async Future&lt;IOStream&gt; perform_attach_to (uint pid, HashTable&lt;string, Variant&gt; options,\n                Cancellable? cancellable, out Object? transport) throws Error, IOError {\nuint id;\n-           string entrypoint = \"frida_agent_main\";\n+           string entrypoint = \"ecool_main\";\nstring parameters = make_agent_parameters (pid, \"\", options);\nAgentFeatures features = CONTROL_CHANNEL;\nvar linjector = (Linjector) injector;\ndiff --git a/src/qnx/qnx-host-session.vala b/src/qnx/qnx-host-session.vala\nindex 69f2995f..e86fb9c1 100644\n--- a/src/qnx/qnx-host-session.vala\n+++ b/src/qnx/qnx-host-session.vala\n@@ -182,7 +182,7 @@ namespace Frida {\n\nvar stream_request = Pipe.open (t.local_address, cancellable);\n\n-           var id = yield qinjector.inject_library_resource (pid, agent_desc, \"frida_agent_main\",\n+           var id = yield qinjector.inject_library_resource (pid, agent_desc, \"ecool_main\",\n                make_agent_parameters (pid, t.remote_address, options), cancellable);\ninjectee_by_pid[pid] = id;\n\ndiff --git a/src/windows/windows-host-session.vala b/src/windows/windows-host-session.vala\nindex 67f1f3ef..4e9f330a 100644\n--- a/src/windows/windows-host-session.vala\n+++ b/src/windows/windows-host-session.vala\n@@ -274,7 +274,7 @@ namespace Frida {\nvar stream_request = Pipe.open (t.local_address, cancellable);\n\nvar winjector = injector as Winjector;\n-           var id = yield winjector.inject_library_resource (pid, agent, \"frida_agent_main\",\n+           var id = yield winjector.inject_library_resource (pid, agent, \"ecool_main\",\n                make_agent_parameters (pid, t.remote_address, options), cancellable);\ninjectee_by_pid[pid] = id;\n\n-- 2.34.1\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0005-ecool_anti_frida_buildpatch","title":"0005-ecool_anti_frida_build.patch","text":"<pre><code>From 40e82bf69ef6494351fc20eff0b411cf1721427b Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 00:55:39 +0800\nSubject: [PATCH] ecool_anti_frida_build\n\n---\n src/anti-frida.py  | 57 ++++++++++++++++++++++++++++++++++++++++++++++\n src/embed-agent.sh |  8 +++++++\n 2 files changed, 65 insertions(+)\ncreate mode 100644 src/anti-frida.py\n\ndiff --git a/src/anti-frida.py b/src/anti-frida.py\nnew file mode 100644\nindex 00000000..172447e6\n--- /dev/null\n+++ b/src/anti-frida.py\n@@ -0,0 +1,57 @@\n+import lief\n+import sys\n+import random\n+import os\n+ \n+def log_color(msg):\n+    print(f\"\\033[1;31;40m{msg}\\033[0m\")\n+ \n+if __name__ == \"__main__\":\n+    input_file = sys.argv[1]\n+    log_color(f\"[*] Patch frida-agent: {input_file}\")\n+    random_name = \"\".join(random.sample(\"ABCDEFGHIJKLMNOPQ\", 5)) # generate random \"frida-agent-arm/64.so\" name\n+    log_color(f\"[*] Patch `frida` to `{random_name}``\")\n+ \n+    binary = lief.parse(input_file)\n+ \n+    if not binary:\n+        exit()\n+ \n+    for symbol in binary.symbols:  # \u4fee\u6539\u7b26\u53f7\u540d\n+        if symbol.name == \"frida_agent_main\":\n+            symbol.name = \"ecool_main\"\n+ \n+        if \"frida\" in symbol.name:\n+            symbol.name = symbol.name.replace(\"frida\", random_name)\n+ \n+        if \"FRIDA\" in symbol.name:\n+            symbol.name = symbol.name.replace(\"FRIDA\", random_name)\n+ \n+    all_patch_string = [\"FridaScriptEngine\", \"GLib-GIO\", \"GDBusProxy\", \"GumScript\"]  # \u5b57\u7b26\u4e32\u7279\u5f81\u4fee\u6539 \u5c3d\u91cf\u4e0e\u6e90\u5b57\u7b26\u4e00\u6837\n+    for section in binary.sections:\n+        log_color(section.name)\n+        if section.name != \".rodata\":\n+            continue\n+        for patch_str in all_patch_string:\n+            addr_all = section.search_all(patch_str)  # Patch \u5185\u5b58\u5b57\u7b26\u4e32\n+            for addr in addr_all:\n+                patch = [ord(n) for n in list(patch_str)[::-1]]\n+                log_color(f\"[*] Current section name={section.name} offset={hex(section.file_offset + addr)} {patch_str}-{\"\".join(list(patch_str)[::-1])}\")\n+                binary.patch_address(section.file_offset + addr, patch)\n+ \n+    binary.write(input_file)\n+ \n+    # thread_gum_js_loop\n+    random_name = \"\".join(random.sample(\"abcdefghijklmn\", 11))\n+    log_color(f\"[*] Patch `gum-js-loop` to `{random_name}`\")\n+    os.system(f\"sed -b -i s/gum-js-loop/{random_name}/g {input_file}\")\n+ \n+    # thread_gmain\n+    random_name = \"\".join(random.sample(\"abcdefghijklmn\", 5))\n+    log_color(f\"[*] Patch `gmain` to `{random_name}`\")\n+    os.system(f\"sed -b -i s/gmain/{random_name}/g {input_file}\")\n+ \n+    # thread_gdbus\n+    random_name = \"\".join(random.sample(\"abcdefghijklmn\", 5))\n+    log_color(f\"[*] Patch `gdbus` to `{random_name}`\")\n+    os.system(f\"sed -b -i s/gdbus/{random_name}/g {input_file}\")\n\\ No newline at end of file\ndiff --git a/src/embed-agent.sh b/src/embed-agent.sh\nindex 6119b5e1..0b679ef9 100755\n--- a/src/embed-agent.sh\n+++ b/src/embed-agent.sh\n@@ -10,6 +10,7 @@ resource_compiler=$7\nresource_config=$8\nlipo=$9\n\n+custom_script=\"%output_dir/../../../../frida-core/src/anti-frida.py\"\npriv_dir=\"$output_dir/frida-agent@emb\"\n\nmkdir -p \"$priv_dir\"\n@@ -22,6 +23,9 @@ collect_generic_agent ()\nelse\ntouch \"$embedded_agent\"\nfi\n+  if [ -f \"$custom_script\" ]; then\n+    python \"$custom_script\" \"$embedded_agent\"\n+  fi\nembedded_agents+=(\"$embedded_agent\")\n}\n\n@@ -54,6 +58,10 @@ case $host_os in\nexit 1\nfi\n\n+    if [ -f \"$custom_script\" ]; then\n+      python \"$custom_script\" \"$embedded_agent\"\n+    fi\n+\n     exec \"$resource_compiler\" --toolchain=gnu -c \"$resource_config\" -o \"$output_dir/frida-data-agent\" \"$embedded_agent\"\n;;\n*)\n-- 2.34.1\n</code></pre>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#0006-ecool_frida_protocol_unexpected_commandpatch","title":"0006-ecool_frida_protocol_unexpected_command.patch","text":"<pre><code>From efe74577dadf4aeb8c8b25a19734de97941cc84a Mon Sep 17 00:00:00 2001\nFrom: ecool &lt;ecool@example.com&gt;\nDate: Fri, 9 Jun 2023 01:00:10 +0800\nSubject: [PATCH] ecool_frida_protocol_unexpected_command\n\n---\n src/droidy/droidy-client.vala | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/src/droidy/droidy-client.vala b/src/droidy/droidy-client.vala\nindex 0ed2edeb..5ab4c006 100644\n--- a/src/droidy/droidy-client.vala\n+++ b/src/droidy/droidy-client.vala\n@@ -1013,7 +1013,7 @@ namespace Frida.Droidy {\ncase \"OPEN\":\n                        case \"CLSE\":\n                        case \"WRTE\":\n-                           throw new Error.PROTOCOL (\"Unexpected command\");\n+                           break;\n\ndefault:\n                            var length = parse_length (command_or_length);\n-- 2.34.1\n</code></pre> <p>\u7f16\u8bd1\u7684\u8fc7\u7a0b\u5c31\u548c\u4e0a\u9762\u7684\u4e00\u6837\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002</p>"},{"location":"Tools/Frida/Frida%E7%BC%96%E8%AF%91%E4%B8%8Epatch/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Building | Frida \u2022 A world-class dynamic instrumentation toolkit</p> <p>[\u539f\u521b]FRIDA Patchs 16.0.9-Android\u5b89\u5168-\u770b\u96ea-\u5b89\u5168\u793e\u533a|\u5b89\u5168\u62db\u8058|kanxue.com</p>"}]}